<html>

<head>
  <link rel="stylesheet" href="./style.css">
  <script src="../dist/umd/graphboard.min.js"></script>
  <style>
    canvas {
      border: 1px solid red;
    }
  </style>

<body>
  <canvas class="canvas" width="800" height="800"></canvas>

</body>
<script>
  const canvas = document.querySelector("canvas");
  const ctx = canvas.getContext("2d");
  var width = canvas.width;
  var height = canvas.height;
  const CENTER = { x: width / 2, y: height / 2 };

  const MAX_DISTANCE = 500; // not used
  const node_radius = 20;


  let graph = new graphboard.Graph();

  var layout;


  function setup() {

    ctx.translate(width / 2, height / 2);

    /* we may want to have distinct min, max values for x and y */
    let min = -width;
    let max = 2 * width;

    let size = 15;
    let node;


    let pos1 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("1", pos1, size); graph.nodeList.push(node);


    let pos2 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("1_1", pos2, size); graph.nodeList.push(node);

    let pos3 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("1_2", pos3, size); graph.nodeList.push(node);

    let pos4 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("1_3", pos4, size); graph.nodeList.push(node);

    let pos5 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("1_4", pos5, size); graph.nodeList.push(node);

    let pos6 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("2_1_4", pos6, size); graph.nodeList.push(node);

    let pos7 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("3", pos7, size); graph.nodeList.push(node);

    let pos8 = new graphboard.Vector.random(min, max);
    node = new graphboard.Node("4", pos8, size); graph.nodeList.push(node);

    graph.linkList.push([0, 1, MAX_DISTANCE]);
    graph.linkList.push([0, 2, MAX_DISTANCE]);
    graph.linkList.push([0, 3, MAX_DISTANCE]);
    graph.linkList.push([0, 4, MAX_DISTANCE]);
    graph.linkList.push([4, 5, MAX_DISTANCE]);


    let circle = new graphboard.Circle();

    layout = new graphboard.ForceDirected(graph);
    

  }


  function clear() {
    ctx.fillStyle = "rgba(234, 236, 238, 0.9)";
    // change origin due to translation
    ctx.fillRect(-width, -height, 2 * width, 2 * height);
  };


  function draw_line(v1, v2) {
    ctx.beginPath();
    ctx.moveTo(v1.x, v1.y);
    ctx.lineTo(v2.x, v2.y);
    ctx.strokeStyle = "rgba(50, 50, 50, 1)";

    ctx.stroke();
    ctx.closePath();
  }

  function draw_links() {
    graph.linkList.forEach((con) => {
      node1 = graph.nodeList[con[0]];
      node2 = graph.nodeList[con[1]];
      draw_line(node1.pos, node2.pos);
    });
  }


  function loop() {

    clear();

    draw_links();

    layout.applyForces();

    graph.nodeList.forEach((node) => {
      node.draw(ctx);
      node.update();
    });

    if (i < max_iterations) {
      requestAnimationFrame(loop);
      i++;
    }
  };

  var i = 0;
  const max_iterations = 100;
  setup();
  loop();

</script>