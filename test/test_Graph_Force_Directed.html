<html>

<head>
  <link rel="stylesheet" href="./style.css">
  <script src="../dist/umd/graphboard.min.js"></script>
  <script src="data-json-simple-graph.js"></script>
  <script src="data_json_criminal_graph.js"></script>

<body>
  <canvas class="canvas" width="800" height="800"></canvas>
</body>
<script>
  const canvas = document.querySelector("canvas");
  //const ctx = canvas.getContext("2d");
  const ctx = graphboard.setupHiDefCanvas(canvas);

  var rect = canvas.getBoundingClientRect();
  var width = rect.width;
  var height = rect.height;
  const CENTER = { x: width / 2, y: height / 2 };

  const MAX_DISTANCE = 500; // not used
  const node_radius = 20;

  let graph = new graphboard.Graph();

  var layout;

  function setup() {

    ctx.translate(width / 2, height / 2);

    /*
        graph.addNode(new graphboard.Node("1"));
        graph.addNode(new graphboard.Node("1_1"));
        graph.addNode(new graphboard.Node("1_2"));
        graph.addNode(new graphboard.Node("1_3"));
        graph.addNode(new graphboard.Node("1_4"));
        graph.addNode(new graphboard.Node("1_4_1"));
        graph.addNode(new graphboard.Node("3"));
        graph.addNode(new graphboard.Node("4"));

        graph.addLink("1", "1_1");
        graph.addLink("1", "1_2");
        graph.addLink("1", "1_3");
        graph.addLink("1", "1_4");
        graph.addLink("1_4", "1_4_1");
        layout = new graphboard.ForceDirected(graph);
    */

    //graph.loadJSON(data_json_simple_graph);

    graph.loadJSON(data_json_criminal_graph_string);    

    layout = new graphboard.ForceDirected(graph);

    console.log


  }


  function clear() {
    ctx.fillStyle = "rgba(234, 236, 238, 0.9)";
    //ctx.fillStyle = "rgb(195,226,234)";
    //ctx.fillStyle = "rgb(176,225,206)";
    // change origin due to translation
    ctx.fillRect(-width, -height, 2 * width, 2 * height);
  };

  function draw_node(node) {
    ctx.beginPath();
    //ctx.fillStyle = "darkGrey";
    ctx.fillStyle = "rgb(176,225,206)";

    ctx.arc(node.pos.x, node.pos.y, node.radius, 0, 2 * Math.PI, false);
    ctx.fill();
    ctx.closePath();
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(node.id, node.pos.x, node.pos.y);
  }

  function draw_line(v1, v2) {
    ctx.beginPath();
    ctx.moveTo(v1.x, v1.y);
    ctx.lineTo(v2.x, v2.y);
    ctx.strokeStyle = "rgba(50, 50, 50, 1)";
    ctx.stroke();
    ctx.closePath();
  }



  function draw_links() {
    graph.linkList.forEach((link) => {
      // node1 = graph.nodeList[link.source];
      // node2 = graph.nodeList[link.target];
      node1 = link.source;
      node2 = link.target;
      draw_line(node1.pos, node2.pos);
    });
  }

  function loop() {

    clear();

    draw_links();

    layout.applyForces();

    graph.nodeList.forEach((node) => {
      draw_node(node);
      //node.update();
    });


    if (i < max_iterations) {
      requestAnimationFrame(loop);
      i++;
     // console.log( i );

    }
  };

  var i = 0;
  const max_iterations = 200;
  console.log( max_iterations );
  setup();
  console.log( max_iterations );
  console.log( graph.getNodeCount() );
  console.log( graph.getLinkCount() );
  console.log( graph.getNodeCount() *  graph.getNodeCount()  );
  console.log( graph.getNodeCount() *  graph.getLinkCount() );

  loop();

</script>