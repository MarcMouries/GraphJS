!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).graphjs={})}(this,(function(t){"use strict";function e(t){var e=window.devicePixelRatio||1,i=t.getContext("2d");console.log("─────────────────────────"),console.log("│ setupHiDefCanvas      │"),console.log("─────────────────────────"),console.log("  devicePixelRatio : "+e),console.log("  canvas.width  : "+t.width),console.log("  canvas.height : "+t.height);var n=t.getBoundingClientRect();console.log("  rect.width  : "+n.width),console.log("  rect.height : "+n.height);var o=t.width,s=t.height;return t.width=o*e,t.height=s*e,i.scale(e,e),t.style.width=o+"px",t.style.height=s+"px",console.log("  canvas.style.width  : "+t.style.width),console.log("  canvas.style.height  : "+t.style.height),console.log("  canvas.width  : "+t.width),console.log("  canvas.height : "+t.height),console.log(" └───────────────────────┘"),i}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=l(t);if(e){var o=l(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return u(this,i)}}function f(t,e){var i=function(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}(t,e,"get");return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,i)}function v(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}var g=function(){function t(e){n(this,t),this.ctx=e}return s(t,[{key:"drawGrid",value:function(t,e){this.ctx.save(),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,t,e),this.ctx.lineWidth=.3,this.ctx.strokeStyle="lightgray",this.ctx.fillStyle="black";for(var i=1;i<t;i++)this.ctx.beginPath(),i%10==0&&(this.ctx.moveTo(i,0),this.ctx.lineTo(i,e),this.ctx.moveTo(i,0)),this.ctx.closePath(),this.ctx.stroke();for(var n=1;n<e;n++)this.ctx.beginPath(),n%10==0&&(this.ctx.moveTo(0,n),this.ctx.lineTo(t,n),this.ctx.moveTo(0,n)),this.ctx.closePath(),this.ctx.stroke();this.ctx.lineWidth=1,this.ctx.strokeStyle="gray",this.ctx.beginPath();for(var o=50;o<t;o+=10)o%50==0?(this.ctx.moveTo(o,0),this.ctx.lineTo(o,30),this.ctx.fillText(" ".concat(o),o,30)):(this.ctx.moveTo(o,0),this.ctx.lineTo(o,10));this.ctx.closePath(),this.ctx.stroke(),this.ctx.beginPath();for(var s=50;s<e;s+=10)s%50==0?(this.ctx.moveTo(0,s),this.ctx.lineTo(30,s),this.ctx.fillText(" ".concat(s),30,s)):(this.ctx.moveTo(0,s),this.ctx.lineTo(10,s));this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}}]),t}();var p=function(){function t(e,i){n(this,t),this.x=e||0,this.y=i||0,(isNaN(e)||isNaN(i))&&console.warn("Vector(): parameters are not number: (".concat(e,"), ").concat(i," "))}return s(t,[{key:"add",value:function(e){return e instanceof t?(this.x+=e.x,this.y+=e.y,this):"number"==typeof e?(this.x+=e,this.y+=e,this):void console.error("Parameter in Vector.add(n) Not supported: ".concat(e,")"))}},{key:"copy",value:function(){return new t(this.x,this.y)}},{key:"div",value:function(t){return 0===t||(this.x/=t,this.y/=t),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e||0,this.y+=(t.y-this.y)*e||0,this}},{key:"heading",value:function(){return Math.atan2(this.y,this.x)}},{key:"magSq",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"mag",value:function(){return Math.sqrt(this.magSq())}},{key:"normalize",value:function(){return this.div(this.mag())}},{key:"mult",value:function(t){return isNaN(t)&&console.error("Vector.mult: parameter is not a number: (".concat(t,")")),this.x*=t,this.y*=t,this}},{key:"setMag",value:function(t){return this.normalize().mult(t)}},{key:"sub",value:function(e){return e instanceof t?(this.x-=e.x,this.y-=e.y,this):"number"==typeof e?(this.x-=e,this.y-=e,this):void console.error("Parameter in Vector.sub(n) Not supported: ".concat(e,")"))}},{key:"toString",value:function(){return"["+this.x+", "+this.y+"]"}}],[{key:"add",value:function(e,i){return new t(e.x+i.x,e.y+i.y)}},{key:"div",value:function(t,e){return t.copy().div(e)}},{key:"lerp",value:function(t,e,i){return t.copy().lerp(e,i)}},{key:"random",value:function(e,i){return new t(y(e,i),y(e,i))}},{key:"sub",value:function(e,i){return new t(e.x-i.x,e.y-i.y)}}]),t}();function y(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function x(t,e){return"Circle"==e.type?function(t,e){if(!(t.x<e.x-e.radius))return!1;if(!(t.x+t.width>e.x+e.radius))return!1;if(!(t.y+t.height>e.y+e.radius))return!1;if(!(t.y<e.y-e.radius))return!1;return!0}(t,e):"Rectangle"==e.type?(n=e,o=(i=t).x<n.x&&i.x+i.width>n.x+n.width,s=i.y<n.y&&i.y+i.height>n.y+n.height,o&s):(console.error("rectContainsShape: shape is unknown: "+e),void console.error(e));var i,n,o,s}var m=function t(e,i){n(this,t),e.id&&i.id?this.id=e.id+" → "+i.id:this.id=e+" → "+i,this.source=e,this.target=i},k=function(){function t(e,i){n(this,t),this.id=e,this.data=i,this.children=[],this.isCollapsed=!1,this.size=20,this.mass=13,this.radius=this.size,this.pos=new p(0,0),this.velocity=new p(0,0),this.acceleration=new p(0,0)}return s(t,[{key:"toString",value:function(){return"Node "+this.id+" ("+this.x+", "+this.y+")"}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"getAdjacents",value:function(){return this.children}},{key:"isAdjacent",value:function(t){return this.children.indexOf(t)>-1}}]),t}(),b=function(){function t(){n(this,t),this.graph={},this.nodeList=new Map,this.linkList=[],this.adjacency={},this.changed=!1,this.root}return s(t,[{key:"addNode",value:function(t){return t.id in this.graph?console.error("Node already exists: "+t.id):(this.nodeList.set(t.id,t),this.graph[t.id]=t),t}},{key:"getNode",value:function(t){return this.nodeList.get(t)}},{key:"removeNode",value:function(t){this.nodeList.delete(t)}},{key:"addObject",value:function(t){var e=new k(t.id,t);return t.parentId?(e.parent=this.getNode(t.parentId),e.parent?(e.level=e.parent.level+1,e.parent.children.push(e)):console.error("Parent node not found for parentId: "+t.parentId)):this.root=e,this.addNode(e),this.changed=!0,e}},{key:"getLinkCount",value:function(){return this.linkList.length}},{key:"getNodeCount",value:function(){return this.nodeList.size}},{key:"addLink",value:function(t,e){var i=this.getNode(t);if(null==i)throw new TypeError("Trying to add a link to the non-existent node with id: "+t);var n=this.getNode(e);if(null==n)throw new TypeError("Trying to add a link to the non-existent node with id: "+e);var o=new m(i,n),s=!1;this.linkList.forEach((function(t){o.id===t.id&&(s=!0)})),s?console.log("LINK EXIST:  source: "+o.source.id+" => "+o.target.id):(this.linkList.push(o),i.addChild(n)),o.source.id in this.adjacency||(this.adjacency[o.source.id]={}),o.target.id in this.adjacency[o.source.id]||(this.adjacency[o.source.id][o.target.id]=[]),this.adjacency[o.source.id][o.target.id].push(o)}},{key:"loadJSON",value:function(t){var e;console.log("Graph.loadJSON: json_string: "),console.log(t),"string"==typeof t?(console.log("Graph.loadJSON: input is of type string: "),e=JSON.parse(t)):"object"===i(t)&&(console.log("Graph.loadJSON: input is of type object: "),e=t);for(var n=e.nodes,o=0;o<n.length;o++){var s=n[o];this.addObject(s)}var r=e.links;if(r)for(var a=0;a<r.length;a++){var l=r[a];this.addLink(l.source,l.target)}console.log("Graph.loadJSON:  loaded Graph="),console.log(this.graph)}},{key:"toString",value:function(){return Array.from(this.nodeList.values()).map(w)}}]),t}();function w(t){var e="";return e=0==t.getAdjacents()?"no children":t.getAdjacents().map((function(t){return t.id})).join(", "),t.id+" => "+e}var C=function(t){a(i,t);var e=d(i);function i(t,o){var s;return n(this,i),(s=e.call(this,t,o)).children=[],s.parent,s.level=1,s.path="1",s}return s(i,[{key:"addChild",value:function(t){return t.parent=this,this.children.push(t)}},{key:"getChildAt",value:function(t){return this.children[t]}},{key:"getFirstChild",value:function(){return this.getChildAt(0)}},{key:"getChildren",value:function(){return this.children}},{key:"getChildrenCount",value:function(){return this.children.length}},{key:"isLeftMost",value:function(){return!this.parent||null===this.parent||this.parent.getFirstChild()===this}},{key:"isRightMost",value:function(){return!this.parent||null===this.parent||this.parent.getLastChild()===this}},{key:"getLastChild",value:function(){return this.getChildAt(this.getChildrenCount()-1)}},{key:"getLeftSibling",value:function(){if(null===this.parent||this.isLeftMost())return null;var t=this.parent.children.indexOf(this);return this.parent.children[t-1]}},{key:"isLeaf",value:function(){return this.children&&0==this.children.length}},{key:"hasChild",value:function(){return this.children&&this.children.length>0}},{key:"isAncestorCollapsed",value:function(){return null!=this.parent&&(!!this.parent.isCollapsed||-1!==this.parent.id&&this.parent.isAncestorCollapsed())}},{key:"getRightSibling",value:function(){if(null===this.parent||this.isRightMost())return null;var t=this.parent.children.indexOf(this);return this.parent.children[t+1]}},{key:"getLeftMostChild",value:function(){return 0==this.getChildrenCount()?null:this.children[0]}},{key:"getRightMostChild",value:function(){return 0==this.getChildrenCount()?null:this.children[this.getChildrenCount()-1]}},{key:"hasLeftSibling",value:function(){return!this.isLeftMost()}},{key:"getIndex",value:function(){return this.parent.children.indexOf(this)}}]),i}(k),S=function(t){a(i,t);var e=d(i);function i(){var t;return n(this,i),(t=e.call(this)).root=null,t.nodeMap=new Map,t}return s(i,[{key:"setRoot",value:function(t){this.root=t}},{key:"getRoot",value:function(){return this.root}},{key:"isRoot",value:function(t){return t===this.root}},{key:"traverseDF",value:function(t){!function e(i){t(i),i.children&&i.children.forEach(e)}(this.root)}},{key:"traverseBF",value:function(t){for(var e=[this.root];e.length;){var i=e.shift();t(i),i.children.forEach((function(t){return e.push(t)}))}}},{key:"getNode",value:function(t){return this.nodeMap.get(t)}},{key:"loadFromJSON",value:function(t){var e=this,i=JSON.parse(t);return i.forEach((function(t){var i=t.id,n=t.data,o=new C(i,n,null);e.nodeMap.set(i,o)})),i.forEach((function(t){var i=t.id,n=t.parentId,o=e.nodeMap.get(i);if(n){var s=e.nodeMap.get(n);if(!s)return{status:"error",message:"Parent node not found for parentId: "+n};var r=s.addChild(o);o.level=o.parent.level+1;var a=o.parent?o.parent.path+"-":"";o.path=a+(r+1),console.log("Node ".concat(i," / index : ").concat(r,"  / path : ").concat(o.path))}else e.root=o})),{status:"success"}}}]),i}(b),L=function(){function t(e,i){n(this,t),this.graph=e}return s(t,[{key:"calculate_Positions",value:function(t,e,i){console.error("not implemented in AbstractGraphLayout. Make sure to use a concrete layout class.")}}]),t}(),M=function(t){a(i,t);var e=d(i);function i(t,o){var s;n(this,i),r(h(s=e.call(this)),"animate",(function(){console.log("animate")})),s.graph=t,s.initNodes();return s.options=Object.assign({},{GRAVITY:.9,REPULSION:5e5},o),s}return s(i,[{key:"initNodes",value:function(){this.graph.nodeList.forEach((function(t){t.pos=new p.random(-1e3,1e3)}))}},{key:"run",value:function(){console.log("run")}},{key:"applyForce",value:function(t,e){var i=p.div(e,t.mass);t.acceleration.add(i)}},{key:"updateNodesVelocity",value:function(){this.graph.nodeList.forEach((function(t){var e=t.acceleration.copy().div(t.mass);t.pos.add(e)}))}},{key:"applyForcesTowardsCenter",value:function(){var t=this;this.graph.nodeList.forEach((function(e){var i=e.pos.copy().mult(-1).mult(t.options.GRAVITY);e.acceleration=i}))}},{key:"applyRepulsiveForces",value:function(){for(var t=Array.from(this.graph.nodeList.values()),e=0;e<t.length-1;e++)for(var i=e+1;i<t.length;i++)if(e!=i){var n=t[e],o=t[i],s=p.sub(o.pos,n.pos),r=s.mag();s.normalize();var a=s.mult(this.options.REPULSION);a.div(r*r);var l=a.copy().mult(-1);o.acceleration.add(a),n.acceleration.add(l)}}},{key:"applyForcesExertedByConnections",value:function(){this.graph.linkList.forEach((function(t){var e=t.source,i=t.target,n=p.sub(e.pos,i.pos),o=new p(0,0).sub(n),s=new p(0,0).add(n);e.acceleration.add(o),i.acceleration.add(s)}))}},{key:"applyForces",value:function(){this.applyForcesTowardsCenter(),this.applyRepulsiveForces(),this.applyForcesExertedByConnections(),this.updateNodesVelocity()}}]),i}(L),E={rootOrientation:"NORTH",maximumDepth:3,levelSeparation:50,marginTop:10,marginLeft:10,siblingSpacing:50,subtreeSeparation:160,stackedLeaves:!0,stackedIndentation:40,nodeWidth:0,nodeHeight:0},N=function(t){a(i,t);var e=d(i);function i(t,o){var s;for(var r in n(this,i),(s=e.call(this,t)).lastNodeAtLevel=[],s.options=Object.assign({},E,o),o||(o={}),E)s[r]=r in o?o[r]:E[r];s.levelSeparation<2*s.nodeHeight&&(s.levelSeparation=2*s.nodeHeight),s.subtreeSeparation,s.nodeWidth,console.log("TreeLayout constructed."),console.log(h(s));var a=function t(e,i){e.prelim=0,e.modifier=0,e.width=e.width||s.nodeWidth,e.height=e.height||s.nodeHeight,c(e);var n=e.getLeftSibling();if(e.isLeaf()||e.level==s.maximumDepth)if(n){e.prelim=n.prelim+s.siblingSpacing;var o=u(e,n);e.prelim+=o}else e.prelim=0;else{for(var r=e.getChildrenCount(),a=0;a<r;a++){t(e.getAdjacents()[a],i+1)}var h=l(e);if(n){e.prelim+=n.prelim+s.siblingSpacing;var d=u(e,n);e.prelim+=d,e.modifier=e.prelim-h,console.log("Calling Apportion for = "+e.id+" - level = "+i),f(e,i)}else e.prelim=h}},l=function(t){var e=t.getLeftMostChild(),i=t.getRightMostChild();return(e.prelim+i.prelim)/2},c=function(t){var e=t.isLeftMost(),i=t.isRightMost();console.log("setNodeNeighbor NODE= "+t.id+" , level= "+t.level+", isLeftMost("+e+"), isRightMost("+i+")"),i?s.lastNodeAtLevel[t.level]=t:e&&(t.neighbor=s.lastNodeAtLevel[t.level],t.neighbor)},u=function(t,e){var i=0;switch(s.rootOrientation){case"NORTH":case"SOUTH":t&&(i=t.width),e&&(i=e.width);break;case"EAST":case"WEST":t&&(i=t.height/2),e&&(i=e.height/2)}return i},d=function t(e,i,n){if(i>=n)return e;if(e.isLeaf())return null;for(var o=e.getChildrenCount(),s=0;s<o;s++){var r=t(e.children[s],i+1,n);if(r)return r}},f=function(t,e){var i=t.children[0],n=i.neighbor,o=1,r=s.maximumDepth-e;if(i&&n&&o<r){var a,l,c,h;l=0,a=0,c=i,h=n;for(var u=0;u<o;u+=1)c=c.parent,h=h.parent,a+=c.modifier,l+=h.modifier;var f=n.prelim+l+s.subtreeSeparation+10-(i.prelim+a);if(f>0){var v,g,p=0;for(v=t;v&&v!==h;v=v.getLeftSibling())p+=1;if(!v)return;var y=f/p;for(g=t;g!==h;)g.prelim+=f,g.modifier+=f,f-=y,g=g.getLeftSibling()}o++,(i=0===i.getChildrenCount()?d(t,0,o):i.getFirstChild())&&(n=i.neighbor)}},v=function t(e,i,n){if(i<=s.maximumDepth){if(e.x=s.marginLeft+e.prelim+n,e.y=s.marginTop+i*s.levelSeparation,s.stackedLeaves&&e.isLeaf()){var o=e.getIndex();e.x=e.parent.x+s.stackedIndentation,e.y+=e.getIndex()*s.nodeHeight+e.getIndex()*s.siblingSpacing,console.log("secondWalk: ".concat(e," #").concat(o,"  (").concat(e.x,", ").concat(e.y,")"))}for(var r=e.getChildrenCount(),a=0;a<r;a++){t(e.children[a],i+1,n+e.modifier)}}};return s.calculate_Positions=function(t,e){console.log("calculate_Positions",h(s),e),console.log("root",t);var i=t;a(i,0),v(i,0,0)},s.getTreeDimension=function(){return{"TO DO":""}},s}return i}(L),T="none",j=function(){function t(e,i,o){n(this,t),this.type=o,this.x=e,this.y=i,this.isSelected=!1,this.strokeStyle=T}return s(t,[{key:"getColor",value:function(){return this.color}}]),t}(),O=function(t){a(i,t);var e=d(i);function i(t,o,s,r){var a;return n(this,i),(a=e.call(this,t,o,"Arc")).radius=s,a.radians=r,a}return s(i,[{key:"isHit",value:function(t,e){var i=this.x-t,n=this.y-e;if(i*i+n*n<this.radius*this.radius)return!0}},{key:"render",value:function(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,this.radians,!1),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle!=T&&(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.stroke()),t.restore()}}]),i}(j),P=function(t){a(i,t);var e=d(i);function i(t,o,s){var r;return n(this,i),(r=e.call(this,t,o,s,2*Math.PI)).type="Circle",r}return s(i,[{key:"isHit",value:function(t,e){var i=this.x-t,n=this.y-e;if(i*i+n*n<this.radius*this.radius)return!0}},{key:"getBBox",value:function(){return{x:this.x-this.radius,y:this.y-this.radius,width:2*this.radius,height:2*this.radius}}}]),i}(O),_=function(t){a(i,t);var e=d(i);function i(t,o,s,r){var a;return n(this,i),(a=e.call(this,t,o,"Rectangle")).width=s,a.height=r,a}return s(i,[{key:"getArea",value:function(){return this.width*this.height}},{key:"isHit",value:function(t,e){if(t>this.x&&t<this.x+this.width&&e>this.y&&e<this.y+this.height)return!0}},{key:"render",value:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle!=T&&(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.stroke()),t.restore()}},{key:"toString",value:function(){return"rectangle:  (".concat(this.x,",").concat(this.y,") x (").concat(this.width,",").concat(this.height,")")}}]),i}(j),D=function(){function t(e,i){n(this,t),console.log("InputDeviceTracker ()"),this.canvas=e,this.callback=i,this.translatedPos={x:0,y:0},this.netPanningX=0,this.netPanningY=0,this.lastMoveX=0,this.lastMoveY=0,this.startDragOffset={x:0,y:0},this.canvas.addEventListener("mousedown",this.onDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMove.bind(this)),this.canvas.addEventListener("mouseup",this.onUp.bind(this)),this.canvas.addEventListener("touchstart",this.onDown.bind(this)),this.canvas.addEventListener("touchmove",this.onMove.bind(this)),this.canvas.addEventListener("touchend",this.onUp.bind(this))}return s(t,[{key:"getCoordinatesFromEvent",value:function(t){var e=self.canvas.getBoundingClientRect(),i=e.top,n=e.left;return t.touches?{x:t.touches[0].clientX-n,y:t.touches[0].clientY-i}:{x:t.clientX-n,y:t.clientY-i}}},{key:"onDown",value:function(t){t.preventDefault(),t.stopPropagation();var e=this.getCoordinatesFromEvent(t);this.startDragOffset.x=e.x-this.translatedPos.x,this.startDragOffset.y=e.y-this.translatedPos.y,this.callback("down",e.x,e.y)}},{key:"onUp",value:function(t){t.preventDefault(),this.callback("up")}},{key:"onMove",value:function(t){t.preventDefault(),t.stopPropagation();var e=this.getCoordinatesFromEvent(t);this.callback("move",e.x,e.y)}}]),t}(),R=function(){function t(i,o){var s=this;n(this,t),r(this,"renderFrame",(function(){s.ctx.clearRect(0,0,s.cw,s.ch),s.options.display_grid&&s.renderer.drawGrid(s.cw,s.ch),s.objects.forEach((function(t){if(t.render(s.ctx),t.isSelected){var e;if(t instanceof P){var i=t.getBBox();e=new _(i.x,i.y,i.width,i.height)}else e=new _(t.x,t.y,t.width,t.height);e.strokeStyle=s.options.selection.strokeStyle,e.lineWidth=s.options.selection.lineWidth,e.render(s.ctx)}1==s.isSelecting&&s.selection.render(s.ctx)}))})),console.log("MChart container()"),console.log(i),this.container=i,this.startX=0,this.startY=0,this.lastMoveX=0,this.lastMoveY=0,this.canvas=document.getElementById("canvas"),this.ctx=e(this.canvas),this.cw=this.canvas.width,this.ch=this.canvas.height,this.renderer=new g(this.ctx),this.inputDeviceTracker=new D(this.canvas,this.manageInputEvents.bind(this));this.options=Object.assign({},{display_grid:!1,selection:{strokeStyle:"#CC0000",lineWidth:1,fillStyle:"rgba(255,51,0,0.05)"}},o),this.selection=new _(100,100,100,100),this.selection.strokeStyle=this.options.selection.strokeStyle,this.selection.fillStyle=this.options.selection.fillStyle,this.selection.lineWidth=this.options.selection.lineWidth,this.objects=[],this.translatePos={x:0,y:0},this.netPanningX=0,this.netPanningY=0,this.lastMoveX=0,this.lastMoveY=0,this.isSelecting=!1,this.isDragging=!1,this.clicked_on_the_canvas=!1}return s(t,[{key:"dump",value:function(){console.log("MChart container= "),console.log("- objects= "),console.log(this.objects)}},{key:"addObject",value:function(t){this.objects.push(t)}},{key:"render",value:function(){this.renderFrame(),window.requestAnimationFrame(this.render.bind(this,this.canvas))}},{key:"manageInputEvents",value:function(t,e,i){var n=this;switch(t){case"down":this.mouseIsDown=!0,this.startX=e,this.startY=i,this.lastMoveX=e,this.lastMoveY=i,this.clicked_on_the_canvas=!0;for(var o=this.objects.length-1;o>=0;o--){var s=this.objects[o];s.isHit(e,i)&&(s.isSelected=!0,console.log("Clicked on : "+s.constructor.name+"/"+s.fillStyle),A(this.objects,s),this.clicked_on_the_canvas=!1,this.isSelecting=!1,this.isDragging=!0)}console.log("clicked on the canvas = "+this.clicked_on_the_canvas),this.clicked_on_the_canvas&&(console.log("clicked on the canvas"),this.selection_startX=e,this.selection_startY=i,this.objects.forEach((function(t){console.log("RESET object "+t.fillStyle+" is Circle ? "+(t instanceof P)),t.isSelected=!1})));break;case"up":this.mouseIsDown=!1,console.log("MOUSE UP"),console.log(" isDragging : "+this.isDragging),console.log(" isSelecting : "+this.isSelecting),this.isSelecting&&(console.log(" selection : "+this.selection),this.objects.forEach((function(t){x(n.selection,t)&&(t.isSelected=!0,console.log("object is selected: "+t.constructor.name+"/"+t.fillStyle))}))),this.isSelecting=!1,this.isDragging=!1;break;case"move":if(this.clicked_on_the_canvas&&this.mouseIsDown){this.isSelecting=!0;var r=Math.min(this.selection_startX,this.lastMoveX),a=Math.min(this.selection_startY,this.lastMoveY),l=Math.max(this.selection_startX,this.lastMoveX),c=Math.max(this.selection_startY,this.lastMoveY);this.selection.x=Math.floor(r),this.selection.y=Math.floor(a),this.selection.width=Math.floor(l-r),this.selection.height=Math.floor(c-a)}this.lastMoveX=e,this.lastMoveY=i;var h=e-this.startX,u=i-this.startY;this.startX=e,this.startY=i,this.isDragging&&this.objects.forEach((function(t){t.isSelected&&(t.x+=h,t.y+=u)}))}}},{key:"init",value:function(){this.inputDeviceTracker=new D(this.canvas,this.manageInputEvents.bind(this))}}]),t}();function A(t,e){t.forEach((function(i,n){if(i===e)return t.splice(n,1),void t.push(e)}))}var I=function(){function t(){n(this,t)}return s(t,null,[{key:"createSVGelement",value:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width","100%"),t.setAttribute("height","100%"),t}},{key:"createLine",value:function(t,e,i,n,o){var s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",e),s.setAttribute("y1",i),s.setAttribute("x2",n),s.setAttribute("y2",o),s.setAttribute("stroke","#022D42"),s.setAttribute("stroke-width",.6),t.appendChild(s)}},{key:"deleteLines",value:function(t){t.querySelectorAll("line").forEach((function(t){return t.remove()}))}}]),t}(),F=new WeakMap,W=new WeakMap,Y=new WeakMap,X=new WeakMap,H=function(){function t(e){n(this,t),v(this,F,{writable:!0,value:function(t){var e=this;console.log('drawNode node id: "'.concat(t.id,'", level: ').concat(t.level,", path: ").concat(t.path)),console.log(t);var i=this.nodesContainer.querySelector("[data-node-id='".concat(t.id,"']"));if(console.log("existingChild: ",i),f(this,X).call(this,t),!i){var n=f(this,Y).call(this,t);this.nodesContainer.appendChild(n)}t.isCollapsed||t.children.forEach((function(t){f(e,F).call(e,t)}))}.bind(this)}),v(this,W,{writable:!0,value:function(t){return'\n      <div class="position-card" style="left: '.concat(t.x,"px; top: ").concat(t.y,'px">\n        <div class="position-info">\n          <div class="job-title">').concat(t.data.job_title,'</div>\n          <div class="name">').concat(t.data.name,"</div>\n        </div>\n      \x3c!-- position data --\x3e\n      </div>\n    ")}}),v(this,Y,{writable:!0,value:function(t,e){var i=this;console.log("BuildNode templateHtml",e);var n=f(this,W).call(this,t),o=(new DOMParser).parseFromString(n,"text/html").querySelector(".position-card").cloneNode(!0);o.dataset.nodeId=t.id.toString(),o.style.left="".concat(t.x,"px"),o.style.top="".concat(t.y,"px"),o.style.width="".concat(t.width,"px");var s=t.children.length;if(s>0){var r=document.createElement("span");r.classList.add("child-count"),r.innerHTML=""+s,o.appendChild(r),r.addEventListener("click",(function(t){var e=t.target.parentElement.dataset.nodeId;console.log("nodeId="+e);var n=i.tree.getNode(e);console.log("clickedNode=",n),n.isCollapsed=!n.isCollapsed;var o=i.nodesContainer.querySelectorAll("[data-node-id]"),s=Array.from(o).map((function(t){return t.getAttribute("data-node-id")}));if(console.log("nodes currently displayed=",s),n.isCollapsed){for(var r=i.nodesContainer;r.firstChild;)r.removeChild(r.firstChild);I.deleteLines(i.svg)}f(i,F).call(i,i.tree.getRoot())}))}return o}}),v(this,X,{writable:!0,value:function(t){if(console.log("createLine TODO check if stackedLeaves: ",t),!t.parent||!t.parent.isCollapsed)if(t.isLeaf()){var e={x:t.x,y:t.y+t.height/2},i={x:e.x-this.treeLayout.stackedIndentation/2,y:e.y};I.createLine(this.svg,e.x,e.y,i.x,i.y),I.createLine(this.svg,i.x,i.y,i.x,i.y-this.treeLayout.levelSeparation)}else{if(1==t.level&&!t.isCollapsed&&t.children.length>=1){var n=t.getLeftMostChild(),o=t.getRightMostChild();console.log("=> left Child : "+n),console.log("=> right Child : "+o),I.createLine(this.svg,n.x+t.width/2,n.y-t.height/2,o.x+t.width/2,o.y-t.height/2);var s={x:t.x+t.width/2,y:t.y+t.height/2},r={x:s.x,y:s.y+this.treeLayout.levelSeparation-t.height};I.createLine(this.svg,s.x,s.y,r.x,r.y)}if(void 0!==t.parent){var a={x:t.x+t.width/2,y:t.y},l={x:a.x,y:a.y-t.height/2};I.createLine(this.svg,a.x,a.y,l.x,l.y)}}}}),this.container=e,this.linksContainer=document.createElement("div"),this.linksContainer.className="links",this.container.appendChild(this.linksContainer),this.svg=I.createSVGelement(1e3,1e3),this.linksContainer.appendChild(this.svg),this.nodesContainer=document.createElement("div"),this.nodesContainer.id="nodes",this.container.appendChild(this.nodesContainer),this.tree=new S}return s(t,[{key:"setData",value:function(t){console.log("HERE in setData",t),this.tree.loadFromJSON(JSON.stringify(t)),console.log("tree",this.tree),this.treeLayout=new N(this.tree,{nodeHeight:50,nodeWidth:200});var e=this.tree.getRoot();this.treeLayout.calculate_Positions(e,{x:100,y:100}),console.log("treeLayout",this.treeLayout);var i=this.treeLayout.getTreeDimension();console.log(" -  treeDimension : ",i);var n=document.createElement("style");n.textContent="\n    .position-card {\n      align-items: flex-start;\n      background: #ffffff;\n      border-top: 10px solid #01778e;\n      box-shadow: 0 1px 4px 2px hsla(0, 0%, 80%, 0.3);\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);\n      display: flex;\n      flex-direction: column;\n      font-family: sans-serif;\n      position: absolute;\n      padding: 4px 8px;\n\n    }\n\n.position-card .name {\n  font-size: 12px;\n  font-weight: 300;\n}\n.position-card .job-title {\n  font-size: 14px;\n  font-weight: 500;\n}\n.links {\n  position: relative;\n  z-index: -2;\n}\n.position-info {\n  align-items: flex-start;\n  background-color: white;\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n}\n\n.position-data {\n  background-color: white;\n  display: flex;\n  flex-direction: row;\n  align-content: center;\n  flex-wrap: wrap;\n  align-items: center;\n  justify-content: space-around;\n  width: 100%;\n}\n.child-count {\n  background-color: white;\n  z-index: -1;\n  cursor: pointer;\n  font-size: 0.6em;\n  position: absolute;\n  right: 50%;\n  bottom: 0;\n  padding: 4px;\n  vertical-align: middle;\n  text-align: center;\n  transform: translate(50%, 100%);\n  box-shadow: 0 1px 4px 2px hsla(0, 0%, 80%, 0.3);\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);\n}\n   ",document.head.appendChild(n),f(this,F).call(this,e)}}]),t}();t.AbstractGraphLayout=L,t.Arc=O,t.Circle=P,t.ForceDirected=M,t.Graph=b,t.Link=m,t.MChart=R,t.Node=k,t.OrgChart=H,t.Rectangle=_,t.Renderer=g,t.Tree=S,t.TreeLayout=N,t.TreeNode=C,t.Vector=p,t.rectContainsShape=x,t.setupHiDefCanvas=e,t.to_radians=function(t){return t*(Math.PI/180)},t.version="0.1"}));
//# sourceMappingURL=graphjs.min.js.map
