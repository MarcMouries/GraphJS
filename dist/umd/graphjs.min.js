!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).graphjs={})}(this,(function(t){"use strict";function e(t){var e=window.devicePixelRatio||1,i=t.getContext("2d");console.log("─────────────────────────"),console.log("│ setupHiDefCanvas      │"),console.log("─────────────────────────"),console.log("  devicePixelRatio : "+e),console.log("  canvas.width  : "+t.width),console.log("  canvas.height : "+t.height);var n=t.getBoundingClientRect();console.log("  rect.width  : "+n.width),console.log("  rect.height : "+n.height);var s=t.width,o=t.height;return t.width=s*e,t.height=o*e,i.scale(e,e),t.style.width=s+"px",t.style.height=o+"px",console.log("  canvas.style.width  : "+t.style.width),console.log("  canvas.style.height  : "+t.style.height),console.log("  canvas.width  : "+t.width),console.log("  canvas.height : "+t.height),console.log(" └───────────────────────┘"),i}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function a(t,e){return a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},a(t,e)}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=h(t);if(e){var s=h(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return c(this,i)}}var u=function(){function t(e){i(this,t),this.ctx=e}return s(t,[{key:"drawGrid",value:function(t,e){this.ctx.save(),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,t,e),this.ctx.lineWidth=.3,this.ctx.strokeStyle="lightgray",this.ctx.fillStyle="black";for(var i=1;i<t;i++)this.ctx.beginPath(),i%10==0&&(this.ctx.moveTo(i,0),this.ctx.lineTo(i,e),this.ctx.moveTo(i,0)),this.ctx.closePath(),this.ctx.stroke();for(var n=1;n<e;n++)this.ctx.beginPath(),n%10==0&&(this.ctx.moveTo(0,n),this.ctx.lineTo(t,n),this.ctx.moveTo(0,n)),this.ctx.closePath(),this.ctx.stroke();this.ctx.lineWidth=1,this.ctx.strokeStyle="gray",this.ctx.beginPath();for(var s=50;s<t;s+=10)s%50==0?(this.ctx.moveTo(s,0),this.ctx.lineTo(s,30),this.ctx.fillText(" ".concat(s),s,30)):(this.ctx.moveTo(s,0),this.ctx.lineTo(s,10));this.ctx.closePath(),this.ctx.stroke(),this.ctx.beginPath();for(var o=50;o<e;o+=10)o%50==0?(this.ctx.moveTo(0,o),this.ctx.lineTo(30,o),this.ctx.fillText(" ".concat(o),30,o)):(this.ctx.moveTo(0,o),this.ctx.lineTo(10,o));this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}}]),t}();var d=function(){function t(e,n){i(this,t),this.x=e||0,this.y=n||0,(isNaN(e)||isNaN(n))&&console.warn("Vector(): parameters are not number: (".concat(e,"), ").concat(n," "))}return s(t,[{key:"add",value:function(e){return e instanceof t?(this.x+=e.x,this.y+=e.y,this):"number"==typeof e?(this.x+=e,this.y+=e,this):void console.error("Parameter in Vector.add(n) Not supported: ".concat(e,")"))}},{key:"copy",value:function(){return new t(this.x,this.y)}},{key:"div",value:function(t){return 0===t||(this.x/=t,this.y/=t),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e||0,this.y+=(t.y-this.y)*e||0,this}},{key:"heading",value:function(){return Math.atan2(this.y,this.x)}},{key:"magSq",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"mag",value:function(){return Math.sqrt(this.magSq())}},{key:"normalize",value:function(){return this.div(this.mag())}},{key:"mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"setMag",value:function(t){return this.normalize().mult(t)}},{key:"sub",value:function(e){return e instanceof t?(this.x-=e.x,this.y-=e.y,this):"number"==typeof e?(this.x-=e,this.y-=e,this):void console.error("Parameter in Vector.sub(n) Not supported: ".concat(e,")"))}},{key:"toString",value:function(){return"["+this.x+", "+this.y+"]"}}],[{key:"add",value:function(e,i){return new t(e.x+i.x,e.y+i.y)}},{key:"div",value:function(t,e){return t.copy().div(e)}},{key:"lerp",value:function(t,e,i){return t.copy().lerp(e,i)}},{key:"random",value:function(e,i){return new t(f(e,i),f(e,i))}},{key:"sub",value:function(e,i){return new t(e.x-i.x,e.y-i.y)}}]),t}();function f(t,e){return Math.floor(Math.random()*(e-t+1)+t)}var v=function t(e,n){i(this,t),e.id&&n.id?this.id=e.id+" → "+n.id:this.id=e+" → "+n,this.source=e,this.target=n},y=function(){function t(e,n){i(this,t),this.id=e,this.data=n,this.level=0,this.children=[],this.parent,this.neighbor,this.isCollapsed=!1,this.size=20,this.mass=13,this.radius=this.size,this.pos=new d(0,0),this.velocity=new d(0,0),this.acceleration=new d(0,0)}return s(t,[{key:"toString",value:function(){return"Node "+this.id+"("+this.pos.x+", "+this.pos.y+")"}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"getAdjacents",value:function(){return this.children}},{key:"isAdjacent",value:function(t){return this.children.indexOf(t)>-1}},{key:"getChildAt",value:function(t){return this.children[t]}},{key:"getFirstChild",value:function(){return this.getChildAt(0)}},{key:"getChildrenCount",value:function(){return this.children.length}},{key:"isLeaf",value:function(){return this.children&&0==this.children.length}},{key:"hasChild",value:function(){return this.children&&this.children.length>0}},{key:"getLastChild",value:function(){return this.getChildAt(this.getChildrenCount()-1)}},{key:"isAncestorCollapsed",value:function(){return null!=this.parent&&(!!this.parent.isCollapsed||-1!==this.parent.id&&this.parent.isAncestorCollapsed())}},{key:"isLeftMost",value:function(){return!this.parent||null===this.parent||this.parent.getFirstChild()===this}},{key:"isRightMost",value:function(){return!this.parent||null===this.parent||this.parent.getLastChild()===this}},{key:"getLeftSibling",value:function(){if(null===this.parent||this.isLeftMost())return null;var t=this.parent.children.indexOf(this);return this.parent.children[t-1]}},{key:"getRightSibling",value:function(){if(null===this.parent||this.isRightMost())return null;var t=this.parent.children.indexOf(this);return this.parent.children[t+1]}},{key:"getLeftMostChild",value:function(){return 0==this.getChildrenCount()?null:this.children[0]}},{key:"getRightMostChild",value:function(){return 0==this.getChildrenCount()?null:this.children[this.getChildrenCount()-1]}},{key:"hasLeftSibling",value:function(){return!this.isLeftMost()}}]),t}(),g=function(){function t(){i(this,t),this.graph={},this.nodeList=[],this.linkList=[],this.adjacency={},this.changed=!1,this.root}return s(t,[{key:"addNode",value:function(t){return t.id in this.graph?console.log("Node already exists: "+t.id):(this.nodeList.push(t),this.graph[t.id]=t),t}},{key:"getNode",value:function(t){return this.graph[t]}},{key:"nodeAt",value:function(t){return this.nodeList[t]}},{key:"addObject",value:function(t){var e=new y(t.id,t);return t.parentId?(e.parent=this.getNode(t.parentId),e.parent?(e.level=e.parent.level+1,e.parent.children.push(e)):console.error("Parent node not found for parentId: "+t.parentId)):this.root=e,this.addNode(e),this.changed=!0,e}},{key:"getLinkCount",value:function(){return this.linkList.length}},{key:"getNodeCount",value:function(){return this.nodeList.length}},{key:"addLink",value:function(t,e){var i=this.getNode(t);if(null==i)throw new TypeError("Trying to add a link to the non-existent node with id: "+t);var n=this.getNode(e);if(null==n)throw new TypeError("Trying to add a link to the non-existent node with id: "+e);var s=new v(i,n),o=!1;this.linkList.forEach((function(t){s.id===t.id&&(o=!0)})),o?console.log("LINK EXIST:  source: "+s.source.id+" => "+s.target.id):(this.linkList.push(s),i.addChild(n)),s.source.id in this.adjacency||(this.adjacency[s.source.id]={}),s.target.id in this.adjacency[s.source.id]||(this.adjacency[s.source.id][s.target.id]=[]),this.adjacency[s.source.id][s.target.id].push(s)}},{key:"loadJSON",value:function(t){for(var e=JSON.parse(t),i=e.nodes,n=0;n<i.length;n++){var s=i[n];this.addObject(s)}var o=e.links;if(o)for(var r=0;r<o.length;r++){var h=o[r];this.addLink(h.source,h.target)}console.log("Graph.loadJSON "),console.log(this.graph)}},{key:"toString",value:function(){return this.nodeList.map(p)}}]),t}();function p(t){var e="";return e=0==t.getAdjacents()?"no children":t.getAdjacents().map((function(t){return t.id})).join(", "),t.id+" => "+e}var k=function(){function t(e,n){i(this,t),o(this,"animate",(function(){console.log("animate")})),this.graph=e,this.initNodes();this.options=Object.assign({},{GRAVITY:.9,REPULSION:5e5},n)}return s(t,[{key:"initNodes",value:function(){this.graph.nodeList.forEach((function(t){t.pos=new d.random(-1e3,1e3)}))}},{key:"run",value:function(){console.log("run")}},{key:"applyForce",value:function(t,e){var i=d.div(e,t.mass);t.acceleration.add(i)}},{key:"updateNodesVelocity",value:function(){this.graph.nodeList.forEach((function(t){var e=t.acceleration.copy().div(t.mass);t.pos.add(e)}))}},{key:"applyForcesTowardsCenter",value:function(){var t=this;this.graph.nodeList.forEach((function(e){var i=e.pos.copy().mult(-1).mult(t.options.GRAVITY);e.acceleration=i}))}},{key:"applyRepulsiveForces",value:function(){for(var t=0;t<this.graph.nodeList.length;t++)for(var e=t+1;e<this.graph.nodeList.length;e++)if(t!=e){var i=this.graph.nodeList[t],n=this.graph.nodeList[e],s=d.sub(n.pos,i.pos),o=s.mag();s.normalize();var r=s.mult(this.options.REPULSION);r.div(o*o);var h=r.copy().mult(-1);n.acceleration.add(r),i.acceleration.add(h)}}},{key:"applyForcesExertedByConnections",value:function(){this.graph.linkList.forEach((function(t){var e=t.source,i=t.target,n=d.sub(e.pos,i.pos),s=new d(0,0).sub(n),o=new d(0,0).add(n);e.acceleration.add(s),i.acceleration.add(o)}))}},{key:"applyForces",value:function(){this.applyForcesTowardsCenter(),this.applyRepulsiveForces(),this.applyForcesExertedByConnections(),this.updateNodesVelocity()}}]),t}(),x="none",w=function(){function t(e,n,s){i(this,t),this.type=s,this.x=e,this.y=n,this.isSelected=!1,this.strokeStyle=x}return s(t,[{key:"getColor",value:function(){return this.color}}]),t}(),b=function(t){r(n,t);var e=l(n);function n(t,s,o,r){var h;return i(this,n),(h=e.call(this,t,s)).radius=o,h.radians=r,h}return s(n,[{key:"isHit",value:function(t,e){var i=this.x-t,n=this.y-e;if(i*i+n*n<this.radius*this.radius)return!0}},{key:"render",value:function(t){t.save(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,this.radians,!1),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle!=x&&(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.stroke()),t.restore()}}]),n}(w),m=function(t){r(n,t);var e=l(n);function n(t,s,o){return i(this,n),e.call(this,t,s,o,2*Math.PI)}return s(n,[{key:"isHit",value:function(t,e){var i=this.x-t,n=this.y-e;if(i*i+n*n<this.radius*this.radius)return!0}},{key:"getBBox",value:function(){return{x:this.x-this.radius,y:this.y-this.radius,width:2*this.radius,height:2*this.radius}}}]),n}(b),S=function(t){r(n,t);var e=l(n);function n(t,s,o,r){var h;return i(this,n),(h=e.call(this,t,s)).width=o,h.height=r,h}return s(n,[{key:"getArea",value:function(){return this.width*this.height}},{key:"isHit",value:function(t,e){if(t>this.x&&t<this.x+this.width&&e>this.y&&e<this.y+this.height)return!0}},{key:"render",value:function(t){t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle!=x&&(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.stroke()),t.restore()}},{key:"toString",value:function(){return"rectangle:  (".concat(this.x,",").concat(this.y,") x (").concat(this.width,",").concat(this.height,")")}}]),n}(w),C=function(){function t(e,n){i(this,t),console.log("InputDeviceTracker ()"),this.canvas=e,this.callback=n,console.log("constructor this"),console.log(this),this.canvas.addEventListener("mousedown",this.onDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMove.bind(this)),this.canvas.addEventListener("mouseup",this.onUp.bind(this)),this.canvas.addEventListener("touchstart",this.onDown.bind(this)),this.canvas.addEventListener("touchmove",this.onMove.bind(this)),this.canvas.addEventListener("touchend",this.onUp.bind(this))}return s(t,[{key:"getCoordinatesFromEvent",value:function(t){var e=self.canvas.getBoundingClientRect(),i=e.top,n=e.left;return t.touches?{x:t.touches[0].clientX-n,y:t.touches[0].clientY-i}:{x:t.clientX-n,y:t.clientY-i}}},{key:"onDown",value:function(t){t.preventDefault();var e=this.getCoordinatesFromEvent(t);this.callback("down",e.x,e.y)}},{key:"onUp",value:function(t){t.preventDefault(),this.callback("up")}},{key:"onMove",value:function(t){t.preventDefault();var e=this.getCoordinatesFromEvent(t);this.callback("move",e.x,e.y)}}]),t}(),M=function(){function t(n,s){var r=this;i(this,t),o(this,"renderFrame",(function(){r.ctx.clearRect(0,0,r.cw,r.ch),r.options.display_grid&&r.renderer.drawGrid(r.cw,r.ch),r.objects.forEach((function(t){if(t.render(r.ctx),t.isSelected){var e;if(t instanceof m){var i=t.getBBox();e=new S(i.x,i.y,i.width,i.height)}else e=new S(t.x,t.y,t.width,t.height);e.strokeStyle=r.options.selection.strokeStyle,e.lineWidth=r.options.selection.lineWidth,e.render(r.ctx),console.log("selection rectangle"),console.log(e)}1==r.isSelecting&&r.selection.render(r.ctx)}))})),console.log("MChart container()"),console.log(n),this.container=n,this.startX=0,this.startY=0,this.lastMoveX=0,this.lastMoveY=0,this.canvas=document.getElementById("canvas"),this.ctx=e(this.canvas),this.cw=this.canvas.width,this.ch=this.canvas.height,this.renderer=new u(this.ctx),this.inputDeviceTracker=new C(this.canvas,this.manageInputEvents.bind(this));this.options=Object.assign({},{display_grid:!1,selection:{strokeStyle:"#CC0000",lineWidth:5.5,fillStyle:"rgba(255,51,0,0.05)"}},s),this.selection=new S(100,100,100,100),this.selection.strokeStyle=this.options.selection.strokeStyle,this.selection.fillStyle=this.options.selection.fillStyle,this.selection.lineWidth=this.options.selection.lineWidth,this.objects=[],this.translatePos={x:0,y:0},this.netPanningX=0,this.netPanningY=0,this.lastMoveX=0,this.lastMoveY=0,this.isSelecting=!1,this.isDragging=!1,this.clicked_on_the_canvas=!1}return s(t,[{key:"dump",value:function(){console.log("MChart container= "),console.log("- objects= "),console.log(this.objects)}},{key:"addObject",value:function(t){this.objects.push(t)}},{key:"render",value:function(){this.renderFrame(),window.requestAnimationFrame(this.render.bind(this,this.canvas))}},{key:"manageInputEvents",value:function(t,e,i){var n=this;switch(t){case"down":this.mouseIsDown=!0,this.startX=e,this.startY=i,this.lastMoveX=e,this.lastMoveY=i,this.clicked_on_the_canvas=!0;for(var s=this.objects.length-1;s>=0;s--){var o=this.objects[s];o.isHit(e,i)&&(o.isSelected=!0,console.log("Clicked on : "+o.constructor.name+"/"+o.fillStyle),j(this.objects,o),this.clicked_on_the_canvas=!1,this.isSelecting=!1,this.isDragging=!0)}console.log("clicked on the canvas = "+this.clicked_on_the_canvas),this.clicked_on_the_canvas&&(console.log("clicked on the canvas"),this.selection_startX=e,this.selection_startY=i,this.objects.forEach((function(t){console.log("RESET object "+t.fillStyle+" is Circle ? "+(t instanceof m)),t.isSelected=!1})));break;case"up":this.mouseIsDown=!1,console.log("MOUSE UP"),console.log(" isDragging : "+this.isDragging),console.log(" isSelecting : "+this.isSelecting),this.isSelecting&&(console.log(" selection : "+this.selection),this.objects.forEach((function(t){(function(t,e){if("Circle"==e.constructor.name)return function(t,e){if(!(t.x<e.x-e.radius))return!1;if(!(t.x+t.width>e.x+e.radius))return!1;if(!(t.y+t.height>e.y+e.radius))return!1;if(!(t.y<e.y-e.radius))return!1;return!0}(t,e);if("Rectangle"==e.constructor.name)return n=e,s=(i=t).x<n.x&&i.x+i.width>n.x+n.width,o=i.y<n.y&&i.y+i.height>n.y+n.height,s&o;console.error("rectContainsShape: shape is unknown: "+e);var i,n,s,o})(n.selection,t)&&(t.isSelected=!0,console.log("object is selected: "+t.constructor.name+"/"+t.fillStyle))}))),this.isSelecting=!1,this.isDragging=!1;break;case"move":if(this.clicked_on_the_canvas&&this.mouseIsDown){this.isSelecting=!0;var r=Math.min(this.selection_startX,this.lastMoveX),h=Math.min(this.selection_startY,this.lastMoveY),a=Math.max(this.selection_startX,this.lastMoveX),c=Math.max(this.selection_startY,this.lastMoveY);this.selection.x=Math.floor(r),this.selection.y=Math.floor(h),this.selection.width=Math.floor(a-r),this.selection.height=Math.floor(c-h)}this.lastMoveX=e,this.lastMoveY=i;var l=e-this.startX,u=i-this.startY;this.startX=e,this.startY=i,this.isDragging&&this.objects.forEach((function(t){t.isSelected&&(t.x+=l,t.y+=u)}))}}},{key:"init",value:function(){this.inputDeviceTracker=new C(this.canvas,this.manageInputEvents.bind(this))}}]),t}();function j(t,e){t.forEach((function(i,n){if(i===e)return t.splice(n,1),void t.push(e)}))}t.Arc=b,t.Circle=m,t.ForceDirected=k,t.Graph=g,t.Link=v,t.MChart=M,t.Node=y,t.Rectangle=S,t.Renderer=u,t.Vector=d,t.setupHiDefCanvas=e,t.to_radians=function(t){return t*(Math.PI/180)},t.version="0.1"}));
//# sourceMappingURL=graphjs.min.js.map
